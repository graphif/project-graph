# 优化Tab键和反斜杠键创建节点的字体大小

## 一、问题分析

当前Tab键和反斜杠键创建节点时，新节点的字体大小总是使用默认值（fontScaleLevel = 0），而没有考虑兄弟节点的字体大小。根据需求，新创建的节点应该：

1. 查看同方向兄弟节点的字体大小
2. 如果兄弟节点大小一致，新节点使用相同大小
3. 如果兄弟节点大小不一致，使用父节点大小。
4. 只考虑同方向的兄弟节点（上、下、左、右四个方向）

## 二、实现思路

1. **获取同方向兄弟节点**：根据节点的出边方向，将子节点分为四个方向组
2. **检查兄弟节点字体大小一致性**：遍历同方向兄弟节点，检查它们的fontScaleLevel是否相同
3. **设置新节点字体大小**：如果兄弟节点大小一致，新节点使用相同大小；否则使用父节点大小或默认值
4. **修改两个创建节点的方法**：`onDeepGenerateNode`（Tab键）和`onBroadGenerateNode`（反斜杠键）

## 三、关键修改点

### 1. 修改 `onDeepGenerateNode` 方法（Tab键深度创建节点）

**文件路径**：`/Volumes/移动固态1/project-graph-1/app/src/core/service/controlService/keyboardOnlyEngine/keyboardOnlyTreeEngine.tsx`

**修改内容**：

- 在创建新节点之前，获取父节点的出边

- 根据预方向过滤出同方向的兄弟节点

- 检查这些兄弟节点的字体大小是否一致

- 为新节点设置合适的fontScaleLevel

### 2. 修改 `onBroadGenerateNode` 方法（反斜杠键广度创建节点）

**文件路径**：`/Volumes/移动固态1/project-graph-1/app/src/core/service/controlService/keyboardOnlyEngine/keyboardOnlyTreeEngine.tsx`

**修改内容**：

- 在创建新节点之前，获取父节点的出边

- 根据预方向过滤出同方向的兄弟节点

- 检查这些兄弟节点的字体大小是否一致

- 为新节点设置合适的fontScaleLevel

### 3. 辅助函数（可选）

可以考虑添加一个辅助函数，用于获取同方向兄弟节点并检查字体大小一致性，以避免代码重复。

## 四、实现步骤

1. **在** **`onDeepGenerateNode`** **方法中**：
   - 获取父节点的出边

   - 根据预方向过滤出同方向的兄弟节点

   - 检查兄弟节点的字体大小一致性

   - 为新节点设置合适的fontScaleLevel

2. **在** **`onBroadGenerateNode`** **方法中**：
   - 获取父节点的出边

   - 根据预方向过滤出同方向的兄弟节点

   - 检查兄弟节点的字体大小一致性

   - 为新节点设置合适的fontScaleLevel

3. **测试验证**：
   - 创建树形结构，为不同方向的子节点设置不同的字体大小

   - 使用Tab键和反斜杠键创建新节点

   - 验证新节点的字体大小是否符合预期

## 五、预期效果

1. 当使用Tab键或反斜杠键创建新节点时，新节点的字体大小会与同方向兄弟节点保持一致
2. 如果没有同方向兄弟节点，新节点使用父节点的字体大小
3. 只考虑同方向的兄弟节点，不同方向的节点不影响
4. 保持原有功能不变，只优化字体大小设置

## 六、注意事项

1. 确保代码兼容性，不破坏现有功能
2. 处理边界情况，如没有兄弟节点、兄弟节点字体大小不一致等
3. 保持代码风格一致，遵循现有代码的设计模式
4. 考虑性能影响，避免不必要的计算
