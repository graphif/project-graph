# 快捷编辑功能系列实现方案

## 一、功能概述

将现有的OKK和ERR快捷操作抽取出来，做成一个专项功能系列，名为"快捷编辑"。该功能允许用户通过快捷键快速修改文本节点的颜色、前缀、后缀和内容，并支持开关效果（再次执行同一操作时恢复原状）。

## 二、技术架构

### 1. 设置项扩展

在 `Settings.tsx` 中扩展 Zod schema，添加快捷编辑相关设置项：

```typescript
// 每个快捷编辑操作的配置
interface QuickEditOperation {
  enabled: boolean;
  color: string; // 颜色值
  prefix: string; // 开头添加内容
  suffix: string; // 末尾添加内容
  replace: string; // 替换内容
  toggle: boolean; // 是否支持开关效果
}

// 快捷编辑设置
quickEdit: {
  operations: {
    1: QuickEditOperation;
    2: QuickEditOperation;
    // ... 共7个
  };
}
```

### 2. UI调整

在 `settings.tsx` 的自动化栏目下添加"快捷编辑文本节点"子栏目，包含7个快捷操作设置项，每个设置项可配置：

- 启用状态
- 颜色
- 开头内容
- 末尾内容
- 替换内容

### 3. 功能重构

重构 `textNodeSmartTools.tsx`，将现有的OKK和ERR方法抽象为通用的快捷编辑方法：

```typescript
// 通用快捷编辑方法
static quickEdit(project: Project, operationId: number) {
  // 获取配置
  const config = project.settings.quickEdit.operations[operationId];
  if (!config.enabled) return;

  // 遍历选中的文本节点
  // 实现颜色、前缀、后缀、替换的添加/移除逻辑
  // 支持开关效果
}
```

### 4. 快捷键配置

在 `shortcutKeysRegister.tsx` 中添加7个快捷操作的注册：

```typescript
// 快捷编辑操作快捷键
for (let i = 1; i <= 7; i++) {
  KeyBinds.bind(`quickEdit${i}`, { sequence: [], timeout: 1000 }, () => TextNodeSmartTools.quickEdit(project!, i), {
    description: `快捷编辑操作 ${i}`,
  });
}
```

### 5. 图标和国际化

- 在 `SettingsIcons.tsx` 中为新设置项添加图标
- 更新i18n配置，添加新的翻译文本

## 三、实现步骤

1. **扩展设置项定义**：在 `Settings.tsx` 中添加快捷编辑相关的Zod schema
2. **添加设置项UI**：在 `settings.tsx` 中添加"快捷编辑文本节点"子栏目和7个设置项
3. **重构文本节点工具**：修改 `textNodeSmartTools.tsx`，实现通用的快捷编辑方法
4. **注册快捷键**：在 `shortcutKeysRegister.tsx` 中添加7个快捷操作的快捷键注册
5. **添加图标**：在 `SettingsIcons.tsx` 中为新设置项添加图标
6. **更新国际化**：添加新的翻译文本
7. **测试验证**：验证功能正常工作，包括开关效果

## 四、关键技术点

1. **配置驱动设计**：通过设置项配置快捷操作的行为，提高灵活性和可扩展性
2. **开关效果实现**：通过检测节点当前状态，实现再次执行同一操作时的恢复逻辑
3. **通用化重构**：将现有功能抽象为通用方法，支持多种快捷操作
4. **快捷键管理**：统一管理7个快捷操作的快捷键，支持用户自定义
5. **UI组件复用**：利用现有的SettingField组件，快速构建新的设置项UI

## 五、预期效果

1. 用户可以在设置中配置7个快捷编辑操作
2. 每个操作可以自定义颜色、前缀、后缀和替换内容
3. 支持通过快捷键快速执行这些操作
4. 再次执行同一操作时，恢复节点原始状态
5. 界面清晰，操作直观，提高用户编辑效率

## 六、文件修改列表

1. `/app/src/core/service/Settings.tsx` - 扩展设置项定义
2. `/app/src/sub/SettingsWindow/settings.tsx` - 添加设置项UI
3. `/app/src/core/stage/stageObject/association/textNodeSmartTools.tsx` - 重构功能实现
4. `/app/src/core/stage/shortcutKeysRegister.tsx` - 注册快捷键
5. `/app/src/core/service/SettingsIcons.tsx` - 添加图标
6. 国际化配置文件 - 添加翻译文本

## 七、风险评估

1. **兼容性风险**：现有OKK和ERR快捷键的行为需要保持兼容
2. **性能风险**：7个快捷操作的注册和执行需要优化
3. **UI复杂度**：新增的设置项可能增加UI复杂度，需要合理组织
4. **用户体验**：需要确保操作直观，开关效果符合预期

通过合理的设计和实现，可以有效降低这些风险，确保功能的稳定和易用。
