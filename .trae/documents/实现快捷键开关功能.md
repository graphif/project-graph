# 实现快捷键开关功能

## 核心需求

- 为每个快捷键添加开关功能，支持自定义默认状态
- 在设置页面的快捷键页面中显示开关控件
- 支持开关状态的持久化存储
- 修改相关代码以支持开关状态的触发控制

## 实现步骤

### 1. 修改快捷键定义接口

- 修改 `shortcutKeysRegister.tsx` 中的 `KeyBindItem` 接口，添加 `defaultEnabled: boolean` 属性
- 为所有现有快捷键添加默认 `defaultEnabled: true`
- 支持后续修改特定快捷键的默认启用状态

### 2. 设计持久化存储方案

- **方案选择**：使用现有 `keybinds2.json` 文件，扩展数据结构
- **数据结构设计**：
  ```json
  {
    "shortcutId": {
      "key": "C-z",
      "isEnabled": true
    }
  }
  ```
- **向后兼容**：未设置的快捷键使用 `defaultEnabled` 值

### 3. 扩展快捷键管理系统

- 修改 `KeyBinds.tsx` 和 `KeyBindsUI.tsx`，添加开关状态管理
- 更新 `create` 方法，支持初始化开关状态
- 添加 `toggleEnabled` 方法，支持切换开关状态
- 修改 `get` 和 `set` 方法，支持获取和设置完整的快捷键配置

### 4. 修改快捷键触发逻辑

- 在 `KeyBinds.tsx` 的 `check` 方法中，添加开关状态检查
- 在 `KeyBindsUI.tsx` 的 `check` 方法中，添加开关状态检查
- 只有 `isEnabled` 为 `true` 的快捷键才会被触发

### 5. 更新设置页面组件

- 修改 `keybinds.tsx`，在每个快捷键项中添加开关控件
- 引入 `Switch` 组件（假设已有或从UI库中引入）
- 添加开关状态的保存和加载逻辑
- 支持实时更新开关状态

### 6. 修改快捷键组件

- 更新 `KeyBind` 组件，支持显示和操作开关状态
- 在组件中集成开关控件
- 支持开关状态的回调通知

## 文件修改清单

1. `shortcutKeysRegister.tsx` - 扩展快捷键定义，添加 `defaultEnabled` 属性
2. `KeyBinds.tsx` - 支持项目级快捷键开关管理
3. `KeyBindsUI.tsx` - 支持UI级快捷键开关管理
4. `keybinds.tsx` - 添加设置页面开关控件
5. `KeyBind.tsx` - 更新快捷键组件，集成开关功能

## 技术要点

- 使用现有的Tauri Store进行持久化存储
- 采用扩展数据结构而非新增文件，简化管理
- 保持向后兼容性，旧配置自动迁移
- 实时更新开关状态，无需重启应用
- 支持自定义默认启用状态

## 预期效果

- 每个快捷键都有独立的开关控制
- 设置页面直观显示所有快捷键的开关状态
- 关闭的快捷键不会响应键盘事件
- 开关状态持久化保存，重启应用后保持
- 支持通过修改 `defaultEnabled` 调整默认启用状态

## 风险评估

- 需确保所有现有快捷键都正确添加 `defaultEnabled` 属性
- 需测试快捷键触发逻辑，确保关闭状态的快捷键不会被触发
- 需确保设置页面的开关控件正常工作
- 需确保数据结构扩展后与现有代码兼容

## 测试计划

1. 验证所有快捷键默认开启
2. 测试单个快捷键开关功能
3. 测试多个快捷键批量开关
4. 测试开关状态持久化
5. 测试关闭状态的快捷键是否被正确忽略
6. 测试设置页面开关控件的交互体验
7. 测试修改 `defaultEnabled` 后新配置的效果

## 优化建议

- 考虑添加"全选"和"反选"功能，方便批量管理快捷键开关
- 考虑添加快捷键分组开关，方便按组管理
- 考虑添加重置开关状态到默认值的功能

## 实现细节

- 使用 `isEnabled` 表示当前启用状态，`defaultEnabled` 表示默认启用状态
- 存储时只保存与默认值不同的配置，节省存储空间
- 加载时优先使用存储的配置，否则使用默认值
- 开关状态与快捷键键位独立管理，允许单独修改
